#!/usr/bin/env python3
# SPDX-License-Identifier: Apache-2.0
# Copyright(c) 2025 Wind River Systems, Inc.

import json
import sys
import yaml

def parse_config(file_path):
    config_facts = {"namespace": "deployment", "principal": False}

    try:
        with open(file_path) as f:
            resources = yaml.safe_load_all(f)

            for resource in resources:
                if not resource:
                    continue

                if resource.get("kind") == "Namespace":
                    name = resource.get("metadata", {}).get("name", "").strip()
                    if name:
                        config_facts["namespace"] = name

                status = resource.get("status", {})
                if status.get("deploymentScope", "").lower().strip() == "principal":
                    config_facts["principal"] = True

    except Exception:
        pass

    return config_facts

try:
    config = parse_config(sys.argv[1])
except (IndexError, Exception):
    config = {"namespace": "deployment", "principal": False}

print(json.dumps(config))
